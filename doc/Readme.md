## ZBUS = MQ + RPC + ServiceProxy

### ZBUS消息队列、服务总线业务常见场景

#### 1 系统解耦

消息队列初衷是为了解决系统之间消息传递问题。消息队列的两头--生产消息者与消费消息者通过消息队列这个中介机构从逻辑上分离出来。

生产者  ===> 消息队列 ===>  消费者

生产者不需要知道消费者的存在，消费者同样也不需要知道生产者的存在。生产者只需要负责生产相应的消息放到中介Broker中，消费者只需消费（或者被动推送）感兴趣的消息并作相应处理。

常见的案例：短信批量发送、邮件后台服务。这些场景往往都是消费者需要相对较长的时间来处理，生产者假定消费者一定会处理好消息。


####2 内部系统开放API

企业内部多系统之间互相访问，几乎都需要跨系统服务调用。解决系统互相调用都涉及到

1）如何把已有业务逻辑代码便捷的开放出服务来

2）如何实现高可用

3）如何实现便捷的扩容机制。
	
面对以上等等常规问题，WebService、HTTP+JSON是常见的解决方案。WebService属于重量级方案，应用起来基本都是笨重不堪的局面，如果不是需要开放服务给互联网，这应该不是个好的解决办法。衍生出来的HTTP+JSON的方案，相对简化了服务内部开放问题，但是仍然在在抽象层次上不够，我们需要的是RPC，是编程结构上无差异化。Spring的整合代理一定程度上解决了在JAVA平台上HTTP+JSON方案向RPC升级，但是同时还存在服务节点散落的问题。
ZBUS的一个重要目标就是完成内部系统开放API的超轻量级解决方案。


#### 3 异构系统适配接入

ZBUS需要重点解决的另外一个目标是，便捷适配代理已有异构系统服务，使得已有服务能够享受到zbus本身支持的所有平台和语言。
这个需求在大部分企业内部会遇到，比如对于证券公司，交易系统传统都是C++服务，互联网应用的引入，JAVA、C#往往无法直接接入到交易系统，成熟的交易系统是不会随便适配到其他平台上。企业更加可能用到第三方公司提供的特殊平台服务，WebService显然也不是业内真正在使用标准，会出现各种私有的平台，这个时候ZBUS的适配能力将为你解决平台异构问题。


以上几种业务场景，从企业服务治理角度来看，ZBUS实际上是充当了SOA面向服务架构的基础设施，这也是ZBUS的起源历史。其目标不是纸上谈兵说SOA，而是务实的方式轻量级来实施SOA理念。



### ZBUS应用构建关系图


#### 1 MQ消息队列

ZBUS的消息队列MQ，远程方法调用RPC，总线代理等等功能设计都是基于下面简单的MQ模型。系统只有三个角色：生产者、中介商（zbus）、消费者，编程模型亦是如此（参考各平台API代码）。

![消息队列](http://git.oschina.net/uploads/images/2015/0701/134430_6d0fbe22_7458.png "MQ消息队列") 

#### 2 CBS请求应答

在消息队列基础上，可以衍生出C=B=S模式：这是CS模式的变种，客户端C请求消息统一到中介商B的队列中，服务端S获取中介商B队列的请求处理后返回给客户端C。这就是借助Broker来实现的C/S模式

![CBS请求应答](http://git.oschina.net/uploads/images/2015/0701/135128_bc247c16_7458.png "CBS请求应答")

Client生产一个请求消息到Broker中，Service消费到请求消息处理后，生产一个应答消息给Broker，最后Client消费到应道消息

#### 3 RPC远程方法调用

基于zbus实现的RPC远程方法调用是在上面C=B=S模式之上的一个协议应用，Client与Service之间的消息规范走JSON，结构化方法调用中的模块、方法、参数（Module\Method\Parameters）。


#### 4 ServiceProxy总线代理

借助zbus可以将第三方服务（Thirdparty）适配成zbus支持的多语言跨平台的服务。结构逻辑如下，代理（Proxy）从zbus上消费取消息，将约定好的消息格式转化为第三方服务对应的协议，一般这个转化都是采用三方服务提供的SDK完成。可以是同步结构也可以是异步结构，由第三方决定，平台语言也由第三方决定，Proxy请求完成的应答最后生产消息回zbus。

![总线代理](http://git.oschina.net/uploads/images/2015/0701/135310_65aff197_7458.png "总线代理")

总线代理结构在zbus用于系统整合主题上大量使用，适配后的第三方服务具备跨语言跨平台能力是这个代理结构的核心目标。
目前zbus直接提供支持的代理主要在金融领域，比如zbus到金证、交易调度、手机证券、银行三方存管等等场景下。

#### 5 ZBUS典型应用结构图


![ZBUS典型应用结构图](http://git.oschina.net/uploads/images/2015/0701/135608_9e360343_7458.png "ZBUS典型应用结构图")


### ZBUS单机启动配置
### ZBUS多机高可用配置
### ZBUS生产消费者模式应用示例
### ZBUS远程方法调用RPC（内部取代WebService）
### ZBUS跨平台语言服务代理
### ZBUS高阶话题--协议
### ZBUS高阶话题--持久化
### ZBUS高阶话题--高可用
### ZBUS高阶话题--监控
